trigger:
  branches:
    include:
      - '*'
    exclude:
      - stable
      - l10n_master
  paths:
    exclude:
      - po/xournalpp.pot
      - po/*.po

stages:
  - stage: 'Build_Test_Stage'
    jobs:
      - job: macOS
        pool:
          vmImage: 'macOS-10.15'
        displayName: 'Test Xournal++ on MacOS'
        steps:
          - template: steps/build_mac.yml
            parameters:
              build_type: 'Debug'
              cmake_flags: '-DCMAKE_DEBUG_INCLUDES_LDFLAGS=ON -DENABLE_GTEST=ON -DDEBUG_COMPILE=ON'
              generation_path: '/Users/xournal-dev'
          - bash: |
              export PATH="$HOME/.local/bin:/Users/xournal-dev/gtk/inst/bin:$PATH"
              otool -L gtest/test-units
              install_name_tool -add_rpath /Users/xournal-dev/gtk/inst/lib/. gtest/test-units
              CI=true ctest --verbose
            workingDirectory: ./build
            displayName: 'Run tests'
